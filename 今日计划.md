- 支付宝订单状态

  WAIT_BUYER_PAY（交易创建，等待买家付款）、0( 订单在数据库中的保存模式)

  TRADE_CLOSED（未付款交易超时关闭，或支付完成后全额退款）、-1

  TRADE_SUCCESS（交易支付成功）、1

  TRADE_FINISHED（交易结束，不可退款）2

- 订单信息界面填写

  - 首先从用户个人信息加载用户已设置的信息
  - 未设置的信息用户个人填写
  - 自动配置的信息同样在本页面支持被用户修改
  - 进入订单支付界面
  - 首先检查对应酒店,房间是否可用
  - (这里涉及到上锁问题 ,暂且忽略)
  - 将订单状态更改为"预订未支付"   ***WAIT_BUYER_PAY***

- 支付宝异步通知更改订单状态

  - 验签

  - 比对订单状态

  - 如果订单状态"失败"

    将订单状态更改为"预订未支付"

  - 订单状态成功

    将订单状态更改为"已支付"

- 支付宝同步通知返回订单信息

  - 显示订单信息
  - 返回界面暂未确定

- 支付宝退款

  - 向支付宝发送退款请求

  - 根据交易时间判断可否退款 ***TRADE_FINISHED***

  - TRADE_FINISHED

    不可退款

  - 退款成功

    - 将订单从所有订单中删除  
    - 将订单状态更改为"已退款" ***TRADE_CLOSED***

- 订单信息查询

  - 向支付宝发送查询请求
  - 返回支付宝内部订单号

